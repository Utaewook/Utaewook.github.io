---
layout: post
title: '환편기 예지 보전'
---

{% include image.html url="https://github.com/Utaewook/PIAI_ResearchIntern/tree/main/ckm/modeling/MSFlow" image="projects/proj-2/thumbnail.png" %}

##### 개요
- **기간**: 2023-10-16 ~ 2023-12-15
- **수행 기관 / 회사**: 포항공과대학교 인공지능연구원
- **키워드 및 기술 스택**: python, pytorch, opencv
- **팀 인원**: 4명


##### 프로젝트 소개<br>
환편기는 Knit 원단을 생산하는 설비로써, Knit 원단은 여러 산업계에 널리 사용되는 원단입니다. 해당 프로젝트는 원가 상승 대비 인건비 절약 및 생산 Loss Rate 최소화, 불량 원단 Zero화 달성에 따른 원가 절감 효과를 기대하는 기술 개발 프로젝트입니다.

{% include image.html image='projects/proj-2/CircularKnittingMachine.jpg' %}

해당 팀에서 배정 받은 업무는 환편기로 직조된 원단의 결점 감지 모델 개발 업무였습니다. 비지도 학습 기반 이상 탐지 알고리즘을 활용해서, 원단의 결점을 이상치로 간주하고 이상치를 탐지해내는 딥러닝 모델을 개발하였습니다. 데이터의 전처리부터, 이상 탐지 모델의 모델링, 경량화 과정까지 모두 진행해보게 되었습니다.

        

##### 맡은 역할과 경험<br>
  1. 입력 데이터(이미지) 전처리
  2. 비전 기반 비지도 이상 탐지 모델 비교 분석
  3. 이상 탐지 모델 개발(MSFlow 모델) 및 테스트
  4. 개발 모델 경량화<br><br>

  우선, 훈련 이미지를 전처리 하는 부분에서 고려해야할 점이 많았습니다. 초기 데이터 구성은 아래와 같았습니다.<br>

  - 정상 데이터: 256 * 256 6,526건
  - 불량 데이터: 512 * 512 8건, 1024 * 1024 1건
  - 미 라벨 데이터: 100 * 100 총 82,054건<br>
  
  데이터 별 픽셀 shape가 모두 달랐으며, 단순히 코드로 resize한다고 해결되는 문제가 아니었습니다. 모델에 패턴을 잘 학습시키기 위해서는, 이미지의 전처리를 통해 정상 이미지의 패턴이 비슷하도록 원단의 구멍의 개수와 크기를 비슷하게 만들어 주는 점이 중요했습니다. 이를 위해서 의논을 통해 두 가지 전처리 방안을 제시 했으며, 의논을 통해 '정상 데이터를 200 * 200, 불량 데이터를 500 * 500 크기로 resize, crop한 다음, 100 * 100 크기의 이미지로 자르는 방안' 을 선택하게 되었습니다. 이 전처리 과정을 통해 정상, 불량, 미 라벨 데이터 모두 비슷한 패턴의 이미지로 맞춰주었습니다. 이후 추가적인 라벨링 과정을 통해 최종적으로<br>

  - train data set: 100 * 100 정상 데이터 총 22,950 건
  - test data set: 100 * 100 정상, 불량 데이터 총 5,324 건(50% 비율)<br>

  데이터 셋을 구축하였습니다.<br><br>

  이상 탐지 모델을 개발하기 위해 다양한 모델들을 비교해보았는데, 주로 살펴 보았던 모델은 Diffusion 기반인 **AnoDDPM**모델, 사전 훈련된 CNN에 패치 설명자와 메모리 뱅크를 활용한 **CFA**모델, 세 종류의 모델 구조를 통해 이상 탐지를 수행하는 **MSFlow**모델 입니다.

  성능과 모델 구축 용이성을 고려했을 때, 가장 적합한 모델로 MSFlow 모델을 선정하였으며, 해당 모델을 통해 데이터셋을 학습시키고, 경량화 또한 진행하게 되었습니다. 

  개발한 MSFlow 모델의 성능
  - AUROC: 99.8
  - fps: 180 <br>
  
  개발을 진행한 모델의 구조와 성능, 경량화에 대해 더 자세한 내용은 [ppt](https://github.com/Utaewook/Utaewook.github.io/blob/gh-pages/assets/img/projects/proj-2/ppt_file.pdf)를 통해 알 수 있습니다.<br><br>



##### 느낀점<br>
  이미지 데이터를 통해 컴퓨터 비전 모델을 구축하고 학습시키는 업무를 실제 기업의 데이터를 통해 진행해보고, 개발을 하면서 다른 연구 인턴, 연구원과 소통하는 과정을 겪을수 있어서 좋았습니다. 특히, 문제 상황들을 마주하게 되면서, 다른 팀원들과 의논하며 문제를 해결해 나가는 값진 경험을 할 수 있었습니다. 데이터의 전처리, 모델 구축, 경량화 과정을 전반적으로 모두 경험 해 볼 수 있었던 점도 매우 좋았습니다. 해당 과제의 진행 계획과 인턴 근무 시간의 제한으로 실제 환편기 기계에 모델이 구동 되는 과정을 보지는 못했다는 아쉬움이 있지만, 실제 적용될 하드웨어 기기(PC, 환편기 기계, 이미지 촬영 카메라)와 모델이 구동될 외부 환경과 같은 요인을 고려해서 모델 개발이 이루어져야 한다는 점 또한 깨닫게 되었습니다.
